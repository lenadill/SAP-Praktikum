<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Clarity - Settings</title>
	<link rel="stylesheet" href="../static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        if (localStorage.getItem('sapAuth') !== 'true') {
            window.location.href = 'login.html';
        }
    </script>
</head>
<body data-require-auth="true">
	<div class="container">
		<aside class="sidebar">
            <div class="sidebar-header">
                <img src="../assets/pictures/sap_logo.png" alt="SAP" class="sidebar-logo">
            </div>
            <nav>
                <ul class="menu">
                    <li class="menu-item">
                        <a href="index.html">
                            <span class="menu-icon"></span>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="dashboard.html">
                            <span class="menu-icon"></span>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="menu-item active">
                        <a href="settings.html">
                            <span class="menu-icon"></span>
                            <span>Settings</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a href="support.html">
                            <span class="menu-icon"></span>
                            <span>Support</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="logout.html" class="logout-btn">Log Out</a>
            </div>
        </aside>

		<main class="main-content">
			<div class="header">
				<h1>Clarity Settings</h1>
                <div class="header-right">
                    <div class="search-container">
                        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <input type="text" id="settingsSearch" class="search-input" placeholder="Search settings" aria-label="Search">
                        <span id="clearSettingsSearch" class="search-clear" title="Clear search">&times;</span>
                    </div>
                </div>
			</div>

			<div class="content-section">
                <div class="settings-container">
                    <!-- User Profile -->
                    <section class="settings-section">
                        <h3>User Profile</h3>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Name</label>
                                <p>Maximilian Mustermann</p>
                            </div>
                            <div class="settings-control">
                                <button class="save-btn" style="padding: 6px 14px; font-size: 0.8rem;">Edit</button>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Email</label>
                                <p>m.mustermann@sap.com</p>
                            </div>
                            <div class="settings-control">
                                <button class="save-btn" style="padding: 6px 14px; font-size: 0.8rem;">Edit</button>
                            </div>
                        </div>
                    </section>

                    <!-- Notifications -->
                    <section class="settings-section">
                        <h3>Notifications</h3>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Email Notifications</label>
                                <p>Receive weekly reports and transaction alerts via email.</p>
                            </div>
                            <div class="settings-control">
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Desktop Notifications</label>
                                <p>Show browser notifications for real-time dashboard updates.</p>
                            </div>
                            <div class="settings-control">
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </section>

                    <!-- Display Settings -->
                    <section class="settings-section">
                        <h3>Display Settings</h3>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Dashboard Language</label>
                                <p>Select your preferred language for the interface.</p>
                            </div>
                            <div class="settings-control">
                                <select class="settings-input">
                                    <option value="de">Deutsch</option>
                                    <option value="en" selected>English</option>
                                    <option value="fr">Français</option>
                                </select>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Default Currency</label>
                                <p>Set the primary currency for all financial reports.</p>
                            </div>
                            <div class="settings-control">
                                <select class="settings-input">
                                    <option value="eur" selected>Euro (€)</option>
                                    <option value="usd">US Dollar ($)</option>
                                    <option value="gbp">British Pound (£)</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <!-- AI Assistant -->
                    <section class="settings-section">
                        <h3>AI Assistant (Joule)</h3>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Wie soll Joule dich nennen?</label>
                                <p>Passe die Anrede deines KI-Assistenten an.</p>
                            </div>
                            <div class="settings-control">
                                <input type="text" id="jouleNickname" class="settings-input" placeholder="z.B. Max" style="border: 1px solid #ddd; padding: 8px; border-radius: 6px;">
                            </div>
                        </div>
                    </section>

                    <!-- Security -->
                    <section class="settings-section">
                        <h3>Security</h3>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Password</label>
                                <p>Last changed 3 months ago.</p>
                            </div>
                            <div class="settings-control">
                                <button class="save-btn">Change Password</button>
                            </div>
                        </div>
                        <div class="settings-row">
                            <div class="settings-info">
                                <label>Two-Factor Authentication</label>
                                <p>Add an extra layer of security to your account.</p>
                            </div>
                            <div class="settings-control">
                                <button class="save-btn" style="background-color: #2c3e50;">Enable 2FA</button>
                            </div>
                        </div>
                    </section>

                    <div style="margin-top: 20px;">
                        <button class="save-btn" id="saveAllSettings" style="width: 100%; padding: 12px;">Save All Changes</button>
                    </div>
                </div>
			</div>

            <footer class="app-footer">
                <p>&copy; 2026 Clarity - A SAP Financial Tracker</p>
                <div class="footer-links">
                    <a href="#">Terms of Service</a>
                    <a href="#">Impressum</a>
                </div>
            </footer>
		</main>
	</div>

	<script src="../static/js/dashboard.js"></script>
    <script src="../static/js/ai-chat.js"></script>
    <script src="../static/js/settings-search.js"></script>
    <script>
        // Load existing config
        fetch('/api/config')
            .then(res => res.json())
            .then(config => {
                if (config.user && config.user.nickname) {
                    document.getElementById('jouleNickname').value = config.user.nickname;
                }
            })
            .catch(err => console.error("Error loading config:", err));

        // Save nickname on button click
        document.getElementById('saveAllSettings').onclick = function() {
            const nickname = document.getElementById('jouleNickname').value.trim();
            fetch('/api/config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user: { nickname: nickname }
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Einstellungen gespeichert! Joule wird dich ab jetzt so nennen.');
                }
            })
            .catch(err => {
                console.error("Error saving config:", err);
                alert('Fehler beim Speichern der Einstellungen.');
            });
        };
    </script>
    <button class="diamond-btn" title="Open AI Assistant" aria-label="Open AI Chat">
        <img src="../assets/icons/joule_logo.png" alt="AI Assistant">
    </button>
</body>
</html>

